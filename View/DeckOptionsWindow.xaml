<Window x:Class="FlashMemo.View.DeckOptionsWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml" 
        xmlns:wrappers="clr-namespace:FlashMemo.ViewModel.Wrappers" 
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:xceed="http://schemas.xceed.com/wpf/xaml/toolkit"
        Title="Deck Options"
        Width="800"
        Height="900"
        MinWidth="800"
        MinHeight="700"
        ResizeMode="CanResize"
        Background="#FF1E1E1E"
        WindowStartupLocation="CenterOwner"
        Closing="Window_Closing">

    <Window.Resources>
        <DataTemplate x:Key="EnumReadableItemTemplate">
            <TextBlock
                Text="{Binding Converter={StaticResource EnumToReadableTextConverter}}"/>
        </DataTemplate>

        <Style x:Key="DeckOptHintStyle"
               TargetType="TextBlock"
               BasedOn="{StaticResource OptionsLabelStyle}">
            <Setter Property="Cursor" Value="Help"/>
            <Setter Property="ToolTipService.InitialShowDelay" Value="235"/>
            <Setter Property="ToolTipService.ShowDuration" Value="30000"/>
        </Style>
    </Window.Resources>

    <Grid Margin="16">

        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- ================= TOP BAR ================= -->

        <DockPanel Grid.Row="0" Margin="0,0,0,16">

            <!-- Save -->
            <Button
                Content="Save"
                Style="{StaticResource NavButtonStyle}"
                Command="{Binding SaveChangesCommand}"
                DockPanel.Dock="Right"
                Width="90"/>

            <!-- Menu -->
            <Menu DockPanel.Dock="Right" Margin="0,0,8,0">
                <MenuItem Header="⋮" Height="40" Width="32">

                    <MenuItem Header="Clone"
                        Command="{Binding ClonePresetCommand}"/>
                    <MenuItem Header="Delete"
                        Click="TryDeletePreset"
                        IsEnabled="{Binding CanEditSaveDelete}"/>
                    <MenuItem Header="Reset to Default"
                        Command="{Binding ToDefaultCommand}"/>
                    <MenuItem Header="Revert"
                        Command="{Binding RevertChangesCommand}"/>

                </MenuItem>
            </Menu>

            <!-- Combo -->
            <ComboBox
                Margin="0,0,8,0"
                Height="40"
                ItemsSource="{Binding AllPresets}"
                Style="{StaticResource DarkAlwaysEnabledComboBox}"
                Opacity="1"
                IsHitTestVisible="True"
                Focusable="True"
                SelectedItem="{Binding CurrentOptions, Mode=OneWay}"
                SelectionChanged="PresetSelectionChanged"
                FontSize="17">

                <ComboBox.ItemTemplate>
                    <DataTemplate>
                        <TextBlock
                            Text="{Binding Name}"
                            Foreground="White"/>
                    </DataTemplate>
                </ComboBox.ItemTemplate>

            </ComboBox>

        </DockPanel>

        <!-- ================= CONTENT ================= -->

        <ScrollViewer Grid.Row="1"
                      VerticalScrollBarVisibility="Auto">

            <StackPanel>

                <!-- ===== DAILY LIMITS ===== -->

                <Border Style="{StaticResource OptionsCardStyle}">
                    <StackPanel>

                        <TextBlock
                            Text="Daily Limits"
                            Style="{StaticResource OptionsSectionTitleStyle}"/>

                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="200"/>
                                <ColumnDefinition Width="260"/>
                            </Grid.ColumnDefinitions>

                            <Grid.RowDefinitions>
                                <RowDefinition/>
                                <RowDefinition/>
                            </Grid.RowDefinitions>

                            <TextBlock
                                Text="New cards / day"
                                Style="{StaticResource OptionsLabelStyle}"/>

                            <xceed:UIntegerUpDown
                                Grid.Column="1"
                                Style="{StaticResource FlatUIntegerUpDownStyle}"
                                Value="{Binding CurrentOptions.DailyLimits.DailyLessonsLimit}"/>

                            <TextBlock
                                Grid.Row="1"
                                Text="Reviews / day"
                                Style="{StaticResource OptionsLabelStyle}"/>

                            <xceed:UIntegerUpDown
                                Grid.Row="1"
                                Grid.Column="1"
                                Style="{StaticResource FlatUIntegerUpDownStyle}"
                                Value="{Binding CurrentOptions.DailyLimits.DailyReviewsLimit}"/>

                        </Grid>

                    </StackPanel>
                </Border>

                <!-- ===== SCHEDULING ===== -->

                <Border Style="{StaticResource OptionsCardStyle}">
                    <StackPanel>

                        <TextBlock
                            Text="Scheduling Multipliers"
                            Style="{StaticResource OptionsSectionTitleStyle}"/>

                        <Grid>

                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="200"/>
                                <ColumnDefinition Width="260"/>
                            </Grid.ColumnDefinitions>

                            <Grid.RowDefinitions>
                                <RowDefinition/>
                                <RowDefinition/>
                                <RowDefinition/>
                            </Grid.RowDefinitions>

                            <TextBlock
                                Text="Good multiplier"
                                Style="{StaticResource DeckOptHintStyle}"
                                ToolTip="A number that a review card's interval is multiplied by after answering good."/>

                            <xceed:DoubleUpDown
                                Grid.Column="1"
                                Minimum="0.1"
                                MaxLength="5"
                                Style="{StaticResource FlatDoubleUpDownStyle}"
                                Value="{Binding CurrentOptions.Scheduling.GoodMultiplier}"/>

                            <TextBlock
                                Grid.Row="1"
                                Text="Easy multiplier"
                                Style="{StaticResource DeckOptHintStyle}"
                                ToolTip="A number that a review card's interval is multiplied by after answering easy."/>

                            <xceed:DoubleUpDown
                                Grid.Row="1"
                                Grid.Column="1"
                                Minimum="0.1"
                                MaxLength="5"
                                Style="{StaticResource FlatDoubleUpDownStyle}"
                                Value="{Binding CurrentOptions.Scheduling.EasyMultiplier}"/>

                            <TextBlock
                                Grid.Row="2"
                                Text="Hard multiplier"
                                Style="{StaticResource DeckOptHintStyle}"
                                ToolTip="A number that a review card's interval is multiplied by after answering hard."/>

                            <xceed:DoubleUpDown
                                Grid.Row="2"
                                Grid.Column="1"
                                Minimum="0.1"
                                MaxLength="5"
                                Style="{StaticResource FlatDoubleUpDownStyle}"
                                Value="{Binding CurrentOptions.Scheduling.HardMultiplier}"/>

                        </Grid>

                    </StackPanel>
                </Border>

                <!-- ===== STAGES AND INTERVALS ===== -->

                <Border Style="{StaticResource OptionsCardStyle}">
                    <StackPanel>

                        <TextBlock
                            Text="Stages and Intervals"
                            Style="{StaticResource OptionsSectionTitleStyle}"/>

                        <Grid>

                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="240"/>
                                <ColumnDefinition Width="260"/>
                            </Grid.ColumnDefinitions>

                            <Grid.RowDefinitions>
                                <RowDefinition/>
                                <RowDefinition/>
                                <RowDefinition/>
                                <RowDefinition/>
                                <RowDefinition/>
                                <RowDefinition/>
                            </Grid.RowDefinitions>

                            <TextBlock
                                Text="Graduate day count"
                                Style="{StaticResource DeckOptHintStyle}"
                                ToolTip="New interval in days when graduating from learning into review (by answering good on the last learning stage, or easy on any learning stage)."/>

                            <xceed:UIntegerUpDown
                                Grid.Column="1"
                                Style="{StaticResource FlatUIntegerUpDownStyle}"
                                Value="{Binding CurrentOptions.Scheduling.GraduateDayCount}" />

                            <TextBlock
                                Grid.Row="1"
                                Text="Easy on new card (days)"
                                Style="{StaticResource DeckOptHintStyle}"
                                ToolTip="Updated interval in days after answering easy on a new card."/>

                            <xceed:UIntegerUpDown
                                Grid.Row="1"
                                Grid.Column="1"
                                Style="{StaticResource FlatUIntegerUpDownStyle}"
                                Value="{Binding CurrentOptions.Scheduling.EasyOnNewDayCount}" />

                            <TextBlock
                                Grid.Row="2"
                                Text="Again on review card (days)"
                                Style="{StaticResource DeckOptHintStyle}"
                                ToolTip="Learning stage that a review card lands on after answering again."/>

                            <xceed:UIntegerUpDown
                                Grid.Row="2"
                                Grid.Column="1"
                                Style="{StaticResource FlatUIntegerUpDownStyle}"
                                Value="{Binding CurrentOptions.Scheduling.AgainOnReviewStage}"
                                Maximum="{Binding CurrentOptions.Scheduling.MaxStage}"
                                Minimum="{Binding CurrentOptions.Scheduling.MinStage}"/>

                            <TextBlock
                                Grid.Row="3"
                                Text="Good on new card (stage)"
                                Style="{StaticResource DeckOptHintStyle}"
                                ToolTip="Learning stage that a new card lands on after answering good."/>

                            <xceed:UIntegerUpDown
                                Grid.Row="3"
                                Grid.Column="1"
                                Style="{StaticResource FlatUIntegerUpDownStyle}"
                                Value="{Binding CurrentOptions.Scheduling.GoodOnNewStage}"
                                Maximum="{Binding CurrentOptions.Scheduling.MaxStage}"
                                Minimum="{Binding CurrentOptions.Scheduling.MinStage}"/>

                            <TextBlock
                                Grid.Row="4"
                                Text="Hard on new card (stage)"
                                Style="{StaticResource DeckOptHintStyle}"
                                ToolTip="Learning stage that a new card lands on after answering hard."/>

                            <xceed:UIntegerUpDown
                                Grid.Row="4"
                                Grid.Column="1"
                                Style="{StaticResource FlatUIntegerUpDownStyle}"
                                Value="{Binding CurrentOptions.Scheduling.HardOnNewStage}"
                                Maximum="{Binding CurrentOptions.Scheduling.MaxStage}"
                                Minimum="{Binding CurrentOptions.Scheduling.MinStage}"/>

                            <TextBlock
                                Grid.Row="5"
                                Text="Learning stages (minutes)"
                                Style="{StaticResource DeckOptHintStyle}"
                                ToolTip="Three learning stages that cards go through before they graduate and become review cards (all values are in minutes)."/>

                            <StackPanel
                                Grid.Row="5"
                                Grid.Column="1"
                                Orientation="Horizontal"
                                HorizontalAlignment="Left"
                                Width="155">

                                <xceed:UIntegerUpDown
                                    Width="43.33"
                                    MaxLength="2"
                                    Margin="0,4,10,4"
                                    Style="{StaticResource FlatUIntegerUpDownStyle}"
                                    Maximum="{Binding CurrentOptions.Scheduling.LearningStages.MaxValueOnAnyStage}"
                                    Minimum="{Binding CurrentOptions.Scheduling.LearningStages.MinValueOnAnyStage}"
                                    Value="{Binding CurrentOptions.Scheduling.LearningStages.First}"/>

                                <xceed:UIntegerUpDown
                                    Width="43.33"
                                    MaxLength="2"
                                    Margin="0,0,10,0"
                                    Style="{StaticResource FlatUIntegerUpDownStyle}"
                                    Maximum="{Binding CurrentOptions.Scheduling.LearningStages.MaxValueOnAnyStage}"
                                    Minimum="{Binding CurrentOptions.Scheduling.LearningStages.MinValueOnAnyStage}"
                                    Value="{Binding CurrentOptions.Scheduling.LearningStages.Second}"/>

                                <xceed:UIntegerUpDown
                                    Width="43.33"
                                    MaxLength="2"
                                    Margin="0,0,0,0"
                                    Style="{StaticResource FlatUIntegerUpDownStyle}"
                                    Maximum="{Binding CurrentOptions.Scheduling.LearningStages.MaxValueOnAnyStage}"
                                    Minimum="{Binding CurrentOptions.Scheduling.LearningStages.MinValueOnAnyStage}"
                                    Value="{Binding CurrentOptions.Scheduling.LearningStages.Third}"/>

                            </StackPanel>

                        </Grid>
                    </StackPanel>
                </Border>

                <!-- ===== SORTING ===== -->

                <Border Style="{StaticResource OptionsCardStyle}">
                    <StackPanel>

                        <TextBlock
                            Text="Sorting"
                            Style="{StaticResource OptionsSectionTitleStyle}"/>

                        <Grid>

                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="200"/>
                                <ColumnDefinition Width="320"/>
                            </Grid.ColumnDefinitions>

                            <Grid.RowDefinitions>
                                <RowDefinition/>
                                <RowDefinition/>
                                <RowDefinition/>
                            </Grid.RowDefinitions>

                            <!-- ================= LESSON ORDER ================= -->

                            <TextBlock
                                Text="Lesson order"
                                Style="{StaticResource OptionsLabelStyle}"/>

                            <StackPanel
                                Grid.Column="1"
                                Orientation="Horizontal"
                                VerticalAlignment="Center">

                                <!-- Order Combo -->
                                <ComboBox
                                    Style="{StaticResource DarkComboBoxStyle}"
                                    Width="180"
                                    ItemsSource="{Binding LessonOrderEnum}"
                                    ItemTemplate="{StaticResource EnumReadableItemTemplate}"
                                    SelectedItem="{Binding CurrentOptions.Sorting.LessonsOrder}" Height="22" Margin="0,0,10,0" FontSize="15"/>

                                <!-- Direction Label -->
                                <TextBlock
                                    Text=" Direction:"
                                    Margin="10,0,15,0"
                                    VerticalAlignment="Center"
                                    Foreground="#CCCCCC" FontSize="15"/>

                                <!-- Direction Toggle -->
                                <Button
                                    Style="{StaticResource SortDirButtonStyle}"
                                    Content="{Binding CurrentOptions.Sorting.LessonsDirArrow}"
                                    ToolTip="{Binding CurrentOptions.Sorting.LessonsDirTooltip}"
                                    Command="{Binding CurrentOptions.Sorting.ToggleLessonsDirCommand}" Height="26" Margin="0,2,0,2" Foreground="#FFFDFF00"/>
                            </StackPanel>

                            <!-- ================= REVIEW ORDER ================= -->

                            <TextBlock
                                Grid.Row="1"
                                Text="Review order"
                                Style="{StaticResource OptionsLabelStyle}"/>

                            <StackPanel
                                Grid.Row="1"
                                Grid.Column="1"
                                Orientation="Horizontal"
                                VerticalAlignment="Center">

                                <!-- Order Combo -->
                                <ComboBox
                                    Width="180"
                                    Style="{StaticResource DarkComboBoxStyle}"
                                    ItemsSource="{Binding ReviewOrderEnum}"
                                    ItemTemplate="{StaticResource EnumReadableItemTemplate}"
                                    SelectedItem="{Binding CurrentOptions.Sorting.ReviewsOrder}" Height="22" Margin="0,0,10,0" FontSize="15"/>

                                <!-- Direction Label -->
                                <TextBlock
                                    Text=" Direction:"
                                    Margin="10,0,15,0"
                                    VerticalAlignment="Center"
                                    Foreground="#CCCCCC" FontSize="15"/>

                                <!-- Direction Toggle -->
                                <Button
                                    Style="{StaticResource SortDirButtonStyle}"
                                    Content="{Binding CurrentOptions.Sorting.ReviewsDirArrow}"
                                    ToolTip="{Binding CurrentOptions.Sorting.ReviewsDirTooltip}"
                                    Command="{Binding CurrentOptions.Sorting.ToggleReviewsDirCommand}" Height="26" Margin="0,2,0,2" Foreground="#FFFFF500"/>
                            </StackPanel>

                            <!-- ================= CARD TYPE ORDER ================= -->

                            <TextBlock
                                Grid.Row="2"
                                Text="Reviews/lessons first"
                                ToolTip="Changes whether your cards are grouped into chunks by state, or random."
                                Style="{StaticResource DeckOptHintStyle}"/>

                            <ComboBox
                                Grid.Row="2"
                                Style="{StaticResource DarkComboBoxStyle}"
                                ItemsSource="{Binding CardStateOrderEnum}"
                                ItemTemplate="{StaticResource EnumReadableItemTemplate}"
                                SelectedItem="{Binding CurrentOptions.Sorting.CardStateOrder}" Grid.Column="1" Margin="0,4,0,2" FontSize="15"/>

                        </Grid>

                    </StackPanel>
                </Border>

            </StackPanel>

        </ScrollViewer>

        <!-- ================= BOTTOM ================= -->

        <StackPanel
            Grid.Row="2"
            Orientation="Horizontal"
            HorizontalAlignment="Right"
            Margin="0,12,0,0">

            <Button
                Content="Close"
                Width="100"
                Style="{StaticResource NavButtonStyle}"
                IsCancel="True"/>

        </StackPanel>

    </Grid>
</Window>
