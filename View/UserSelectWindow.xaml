<Window x:Class="FlashMemo.View.UserSelectWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:FlashMemo.View"
        xmlns:vm="clr-namespace:FlashMemo.ViewModel.Windows"
        xmlns:wrapperVMs="clr-namespace:FlashMemo.ViewModel.Wrappers" d:DataContext="{d:DesignInstance Type=vm:UserSelectVM}"
        mc:Ignorable="d"
        Title="UserSelectWindow"
        Width="700"
        Height="450"
        WindowStartupLocation="CenterScreen"
        ResizeMode="NoResize">
    <Window.Background>
        <LinearGradientBrush EndPoint="0.5,1" StartPoint="0.5,0">
            <GradientStop Color="#FF3E009C"/>
            <GradientStop Color="#FFFF6E6E" Offset="1"/>
        </LinearGradientBrush>
    </Window.Background>

    <Grid Margin="20" MouseDown="ClearFocus">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- HEADER -->
        <TextBlock
            Text="Choose a user"
            FontSize="30"
            FontWeight="SemiBold"
            Margin="0,0,0,12" FontFamily="Yu Gothic UI Semibold" TextAlignment="Center" Foreground="#FFFFA400"/>

        <!-- USER LIST -->
        <ListBox
            Name="UsersList"
            Grid.Row="1"
            ItemsSource="{Binding Users}"
            KeyDown="UserList_KeyDown"
            SelectedItem="{Binding SelectedUser, Mode=TwoWay}"
            Background="Transparent"
            BorderThickness="0"
            HorizontalContentAlignment="Stretch" 
            d:ItemsSource="{d:SampleData ItemCount=3}">

            <ListBox.ItemContainerStyle>
                <Style TargetType="ListBoxItem">
                    <EventSetter
                        Event="MouseDoubleClick"
                        Handler="User_DoubleClick"/>
                </Style>
            </ListBox.ItemContainerStyle>

            <ListBox.ItemTemplate>
                <DataTemplate DataType="{x:Type wrapperVMs:UserVM}">
                    <Border
                        Padding="12"
                        Margin="0,0,0,8"
                        CornerRadius="10"
                        Background="{StaticResource NavBgBrush}">

                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>

                            <!-- USER INFO -->
                            <StackPanel>
                                <Grid>

                                    <!-- Display mode -->
                                    <TextBlock
                                        Text="{Binding Name}"
                                        FontSize="18"
                                        Foreground="#FF00ECC6"
                                        Visibility="{Binding IsRenaming,
                                                    Converter={StaticResource InverseBoolToVisConverter}}"/>

                                    <!-- Edit mode -->
                                    <TextBox
                                        Text="{Binding TempName, UpdateSourceTrigger=PropertyChanged}"
                                        MaxLength="15"
                                        FontSize="18"
                                        Height="28"
                                        VerticalContentAlignment="Center"
                                        HorizontalContentAlignment="Left"
                                        Visibility="{Binding IsRenaming,
                                            Converter={StaticResource BoolToVisConverter}}"

                                        KeyDown="RenameBox_KeyDown"
                                        LostFocus="RenameBox_LostFocus"
                                        LostKeyboardFocus="RenameBox_LostFocus"
                                        Background="#330162FD"
                                        Foreground="#FF00ECC6"
                                        Margin="0,0,246,0"/>
                                </Grid>


                                <TextBlock
                                    Text="{Binding DeckCount, StringFormat='Decks: {0}'}"
                                    Foreground="{StaticResource DeckDimBrush}"/>

                                <TextBlock
                                    Text="{Binding CardCount, StringFormat='Cards: {0}'}"
                                    Foreground="{StaticResource DeckDimBrush}"/>
                            </StackPanel>

                            <!-- ACTIONS -->
                            <StackPanel
                                Grid.Column="1"
                                Orientation="Horizontal"
                                VerticalAlignment="Center">

                                <Button
                                    Content="Rename"
                                    Command="{Binding BeginRenameCommand}"
                                    Style="{StaticResource NavButtonStyle}"
                                    Width="80"
                                    IsEnabled="{Binding IsRenaming, Converter={StaticResource InverseBoolConverter}}"
                                    Visibility="{Binding IsRenaming, Converter={StaticResource InverseBoolToVisConverter}}"/>

                                <Button
                                    Content="Delete"
                                    Click="RemoveButton_Click"
                                    CommandParameter="{Binding}"
                                    Style="{StaticResource NavButtonStyle}"
                                    Width="80"
                                    Margin="6,0,0,0"/>
                            </StackPanel>
                        </Grid>
                    </Border>
                </DataTemplate>
            </ListBox.ItemTemplate>
        </ListBox>


        <!-- FOOTER -->
        <StackPanel
            Grid.Row="2"
            Orientation="Horizontal"
            HorizontalAlignment="Right"
            Margin="0,12,0,0"
            VerticalAlignment="Center">

            <!-- New user name -->
            <TextBox
                x:Name="NewUserNameBox"
                KeyDown="NewUserNameBox_KeyDown"
                Text="{Binding NewUsernameField, UpdateSourceTrigger=PropertyChanged}"
                TextChanged="NewUserNameBox_TextChanged"
                Width="200"
                Height="36"
                Margin="0,0,10,0"
                VerticalContentAlignment="Center"
                FontSize="16"
                ToolTip="Enter new user name"
                Background="#22FFFFFF"
                Foreground="White"
                BorderBrush="{StaticResource NavBorderBrush}"
                BorderThickness="1"/>

            <!-- Create button -->
            <Button
                Style="{StaticResource NavButtonStyle}"
                Content="Create User"
                Name="CreateButton"
                Click="CreateButton_Click"/>

        </StackPanel>
    </Grid>
</Window>
